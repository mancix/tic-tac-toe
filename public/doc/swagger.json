{
  "openapi": "3.0.0",
  "info": {
    "title": "Tic Tac Toe API Documentation",
    "version": "0.1"
  },
  "paths": {
    "/": {
      "post": {
        "tags": [
          "Tic Tac Toe"
        ],
        "description": "New game",
        "operationId": "new_game",
        "responses": {
          "200": {
            "description": "Status ok",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/CalculonResponse"
                }
              }
            }
          },
          "400": {
            "description": "Invalid params error.",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/CalculonBadResponse"
                }
              }
            }
          },
          "500": {
            "description": "Internal server error.",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/CalculonInternalServerErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/v1/calculate/{id}": {
      "get": {
        "tags": [
          "Calculate"
        ],
        "operationId": "get-caluclation",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer",
              "format": "int64"
            },
            "description": "Id of the calculation"
          }
        ],
        "responses": {
          "200": {
            "description": "Status ok",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/CalculonResponse"
                }
              }
            }
          },
          "404": {
            "description": "Not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/CalculonNotFoundResponse"
                }
              }
            }
          },
          "500": {
            "description": "Internal server error.",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/CalculonInternalServerErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/ping": {
      "get": {
        "tags": [
          "Ping"
        ],
        "operationId": "getPing",
        "responses": {
          "200": {
            "description": "Status ok",
            "content": {
              "application/json": {
                "schema": {
                  "properties": {
                    "message": {
                      "type": "string",
                      "example": "pong"
                    }
                  },
                  "type": "object"
                }
              }
            }
          }
        }
      }
    }
  },
  "components": {
    "schemas": {
      "CalculonRequest": {
        "type": "object",
        "properties": {
          "service": {
            "type": "string",
            "enum": [
              "energy",
              "gas"
            ],
            "description": "Service",
            "example": "energy",
            "required": true
          },
          "yearly_consumption": {
            "type": "integer",
            "format": "int64",
            "description": "Yearly consumption",
            "example": 120,
            "required": true
          },
          "current_service_id": {
            "type": "integer",
            "format": "int64",
            "description": "Service id",
            "example": 9,
            "required": true
          },
          "current_provider_id": {
            "type": "integer",
            "format": "int64",
            "description": "Provider id",
            "example": 123
          },
          "current_rate_id": {
            "type": "integer",
            "format": "int64",
            "description": "Rate id",
            "example": 123
          },
          "supply_start_date": {
            "type": "string",
            "format": "date",
            "description": "Supply start date",
            "example": "2021-01-01",
            "required": true
          },
          "bill_start_date": {
            "type": "string",
            "format": "date",
            "description": "Supply end date",
            "example": "2021-12-31",
            "required": true
          },
          "bill_end_date": {
            "type": "string",
            "format": "date",
            "description": "Bill start date",
            "example": "2021-01-01",
            "required": true
          },
          "bill_time": {
            "type": "integer",
            "format": "int64",
            "description": "number of months of the bill",
            "example": 2
          },
          "bill_consumption": {
            "type": "integer",
            "format": "int64",
            "description": "Consumption of the bill",
            "example": 123,
            "required": true
          },
          "bill_market_cost": {
            "type": "number",
            "format": "double",
            "description": "Market cost of the bill",
            "example": 123.45,
            "required": true
          },
          "bill_total_cost": {
            "type": "number",
            "format": "double",
            "description": "Total cost of the bill",
            "example": 123.45,
            "required": true
          },
          "bill_market_type": {
            "type": "string",
            "enum": [
              "free",
              "regulated"
            ],
            "description": "Market type",
            "example": "free",
            "required": true
          },
          "price_guaranteed": {
            "type": "string",
            "enum": [
              "indexed",
              "fixed"
            ],
            "description": "Price guaranteed",
            "example": "indexed"
          }
        }
      },
      "CalculonResponse": {
        "type": "object",
        "properties": {
          "id": {
            "type": "integer",
            "format": "int64",
            "description": "Id of the bill",
            "example": 1234
          },
          "user_savings": {
            "type": "boolean",
            "description": "User savings",
            "example": true
          },
          "market_type": {
            "type": "string",
            "enum": [
              "free",
              "regulated"
            ],
            "description": "Market type",
            "example": "free"
          },
          "savings_code": {
            "type": "string",
            "enum": [
              "TUT_SAV",
              "TUT_OPT",
              "VAL_SAV",
              "VAL_OPT",
              "EXP_SAV",
              "EXP_OPT",
              "OVD_SAV",
              "OVD_OPT"
            ],
            "description": "Savings code",
            "example": "TUT_SAV"
          },
          "current_rate_status": {
            "type": "string",
            "enum": [
              "valid",
              "expiring",
              "overdue"
            ],
            "description": "Current rate status",
            "example": "valid"
          },
          "bill": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "service": {
                  "type": "string",
                  "enum": [
                    "energy",
                    "gas"
                  ],
                  "description": "Service",
                  "example": "energy"
                },
                "consumption": {
                  "type": "integer",
                  "format": "int64",
                  "description": "Consumption",
                  "example": 123
                },
                "market_cost": {
                  "type": "string",
                  "description": "Market cost",
                  "example": "123.45"
                },
                "rate_name": {
                  "type": "string",
                  "description": "Rate name",
                  "example": "Sorgenia Next Energy Sunlight Dual"
                },
                "current_cost": {
                  "type": "string",
                  "description": "Current cost",
                  "example": "0,45 €/KWh"
                },
                "current_fixed_quota": {
                  "type": "string",
                  "description": "Current fixed quota",
                  "example": "10 €/mese luce"
                }
              }
            }
          },
          "rates": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "id": {
                  "type": "integer",
                  "format": "int64",
                  "description": "Id of the rate",
                  "example": 1234
                },
                "name": {
                  "type": "string",
                  "description": "Name of the rate",
                  "example": "Edison Dynamic Luce e Gas"
                },
                "price_guaranteed": {
                  "type": "string",
                  "enum": [
                    "indexed",
                    "fixed"
                  ],
                  "description": "Price guaranteed",
                  "example": "indexed"
                },
                "provider": {
                  "type": "object",
                  "properties": {
                    "id": {
                      "type": "integer",
                      "format": "int64",
                      "description": "Id of the provider",
                      "example": 1234
                    },
                    "name": {
                      "type": "string",
                      "description": "Name of the provider",
                      "example": "Edison"
                    },
                    "logo": {
                      "type": "string",
                      "description": "Logo of the provider",
                      "example": "https://mcdn1.sostariffe.it/img/operatori/edison-energia.png"
                    }
                  }
                },
                "prices": {
                  "type": "array",
                  "items": {
                    "type": "object",
                    "properties": {
                      "service": {
                        "type": "string",
                        "enum": [
                          "energy",
                          "gas"
                        ],
                        "description": "Service",
                        "example": "energy"
                      },
                      "cost": {
                        "type": "string",
                        "description": "Cost",
                        "example": "0,12 €/kWh"
                      },
                      "fixed_cost": {
                        "type": "string",
                        "description": "Fixed cost",
                        "example": "8,25 €/mese luce"
                      }
                    }
                  }
                },
                "yearly_saving": {
                  "type": "number",
                  "format": "double",
                  "description": "Yearly saving",
                  "example": 246.4
                }
              }
            }
          }
        }
      },
      "CalculonBadResponse": {
        "type": "object",
        "properties": {
          "status": {
            "type": "string",
            "example": "ko"
          },
          "response_code": {
            "type": "integer",
            "format": "int64",
            "example": 400
          },
          "message": {
            "type": "string",
            "example": "Missing or invalid values"
          },
          "data": {
            "type": "array",
            "example": [
              "element 0: yearly_consumption is missing or not a float"
            ],
            "items": {
              "type": "string"
            }
          }
        }
      },
      "CalculonNotFoundResponse": {
        "type": "object",
        "properties": {
          "status": {
            "type": "string",
            "example": "ko"
          },
          "response_code": {
            "type": "integer",
            "format": "int64",
            "example": 404
          },
          "message": {
            "type": "string",
            "example": "Not found"
          }
        }
      },
      "CalculonInternalServerErrorResponse": {
        "type": "object",
        "properties": {
          "status": {
            "type": "string",
            "example": "ko"
          },
          "response_code": {
            "type": "integer",
            "format": "int64",
            "example": 500
          },
          "message": {
            "type": "string",
            "example": "Internal server error"
          }
        }
      }
    }
  }
}